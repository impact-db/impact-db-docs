{
 "cells": [
  {
   "cell_type": "raw",
   "metadata": {},
   "source": [
    ".. toctree::\n",
    "   :maxdepth: 2\n",
    "   :caption: Contents:\n",
    "   \n",
    "   Home <self>\n",
    "   description.md\n",
    "   notebooks/upload_demonstration\n",
    "   notebooks/readdemo"
   ]
  },
  {
   "attachments": {},
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# ImpactDB Experimental Data Upload Demo\n",
    "This notebook demostrates how fermentation results can be added to [ImpactDB](https://impact-database.com) using an API\n",
    "\n",
    "The notebook covers how to upload data in the following formats:\n",
    "<ol>\n",
    "  <li>JSON file</li>\n",
    "  <li>Excel file</li>\n",
    "  <li>Plain text</li>\n",
    "</ol>\n",
    "\n",
    "Users are required to authenticate themselves before they can upload data to the database via a token. Users can access their tokens by signing into ImpactDB and navigating to their user information page: [ImpactDB User Info Page](https://impact-database.com)\n",
    "\n",
    "Note: testing of the api can be done using this url: http://localhost:5001/impact-db/us-central1/uploadExperimentalData\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Load Imports"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import json\n",
    "import requests\n",
    "import pandas as pd"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### 1. Upload experimental data from a json file\n",
    "This example data is from a paper in ImpactDB [(Jagtap 2019)](https://impact-database.com/paper/rhodosporidium/production-of-galactitol-from-galactose-by-the-oleaginous-yeast-rhodosporidium-toruloides-ifo0880)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[{'geneticNotes': '',\n",
       "  'heterologousGenes': '',\n",
       "  'integrationSites': '',\n",
       "  'nitrogenLevel': 'sufficient',\n",
       "  'media': 'YPD',\n",
       "  'substrateConc1': '20',\n",
       "  'substrateConc2': '',\n",
       "  'vessel': 'shake flask',\n",
       "  'yield': '0.16',\n",
       "  'titer': '3.2',\n",
       "  'pH': '',\n",
       "  'maximumRate': '0.0267',\n",
       "  'temperature': '30',\n",
       "  'substrate1': 'galactose',\n",
       "  'substrate2': '',\n",
       "  'geneIds': '',\n",
       "  'promoters': '',\n",
       "  'parentStrain': 'IFO0880',\n",
       "  'strain': '',\n",
       "  'averageRate': '0.0267',\n",
       "  'product': 'galactitol',\n",
       "  'optimizedCodons': '',\n",
       "  'geneNames': '',\n",
       "  'directedEvolution': False,\n",
       "  'originSpecies': '',\n",
       "  'volume': '0.050',\n",
       "  'engineeredStrain': '',\n",
       "  'knockedOutGenes': '',\n",
       "  'oxygenLevel': 'sufficient',\n",
       "  'species': 'Rhodosporidium',\n",
       "  'overexpressedGenes': '',\n",
       "  'time': '120',\n",
       "  'bioprocessNotes': ''},\n",
       " {'geneticNotes': '',\n",
       "  'heterologousGenes': '',\n",
       "  'integrationSites': '',\n",
       "  'nitrogenLevel': 'sufficient',\n",
       "  'substrateConc1': '40',\n",
       "  'media': 'YPD',\n",
       "  'substrateConc2': '',\n",
       "  'vessel': 'shake flask',\n",
       "  'yield': '0.21',\n",
       "  'maximumRate': '0.07',\n",
       "  'pH': '',\n",
       "  'temperature': '30',\n",
       "  'titer': '8.4',\n",
       "  'substrate1': 'galactose',\n",
       "  'substrate2': '',\n",
       "  'geneIds': '',\n",
       "  'promoters': '',\n",
       "  'parentStrain': 'IFO0880',\n",
       "  'strain': '',\n",
       "  'averageRate': '0.07',\n",
       "  'product': 'galactitol',\n",
       "  'optimizedCodons': '',\n",
       "  'geneNames': '',\n",
       "  'directedEvolution': False,\n",
       "  'originSpecies': '',\n",
       "  'volume': '0.050',\n",
       "  'engineeredStrain': '',\n",
       "  'knockedOutGenes': '',\n",
       "  'species': 'Rhodosporidium',\n",
       "  'oxygenLevel': 'sufficient',\n",
       "  'overexpressedGenes': '',\n",
       "  'time': '120',\n",
       "  'bioprocessNotes': ''},\n",
       " {'geneticNotes': '',\n",
       "  'heterologousGenes': '',\n",
       "  'integrationSites': '',\n",
       "  'nitrogenLevel': 'sufficient',\n",
       "  'media': 'YPD',\n",
       "  'substrateConc1': '60',\n",
       "  'substrateConc2': '',\n",
       "  'yield': '0.1367',\n",
       "  'vessel': 'shake flask',\n",
       "  'titer': '8.2',\n",
       "  'maximumRate': '0.0854',\n",
       "  'temperature': '30',\n",
       "  'pH': '',\n",
       "  'substrate1': 'galactose',\n",
       "  'substrate2': '',\n",
       "  'geneIds': '',\n",
       "  'promoters': '',\n",
       "  'parentStrain': 'IFO0880',\n",
       "  'averageRate': '0.0854',\n",
       "  'strain': '',\n",
       "  'product': 'galactitol',\n",
       "  'optimizedCodons': '',\n",
       "  'geneNames': '',\n",
       "  'originSpecies': '',\n",
       "  'directedEvolution': False,\n",
       "  'volume': '0.050',\n",
       "  'knockedOutGenes': '',\n",
       "  'engineeredStrain': '',\n",
       "  'species': 'Rhodosporidium',\n",
       "  'oxygenLevel': 'sufficient',\n",
       "  'overexpressedGenes': '',\n",
       "  'time': '96',\n",
       "  'bioprocessNotes': ''},\n",
       " {'geneticNotes': '',\n",
       "  'heterologousGenes': '',\n",
       "  'integrationSites': '',\n",
       "  'nitrogenLevel': 'limited',\n",
       "  'media': '.75g/L yeast extract, 1.7 g/L YNB, 0.1g/L ammonium sulfate',\n",
       "  'substrateConc1': '20',\n",
       "  'substrateConc2': '',\n",
       "  'yield': '0.15',\n",
       "  'vessel': 'shake flask',\n",
       "  'pH': '5.6',\n",
       "  'maximumRate': '0.0208',\n",
       "  'temperature': '30',\n",
       "  'titer': '3.0',\n",
       "  'substrate1': 'galactose',\n",
       "  'substrate2': '',\n",
       "  'geneIds': '',\n",
       "  'promoters': '',\n",
       "  'parentStrain': 'IFO0880',\n",
       "  'averageRate': '0.0208',\n",
       "  'strain': '',\n",
       "  'product': 'galactitol',\n",
       "  'optimizedCodons': '',\n",
       "  'geneNames': '',\n",
       "  'directedEvolution': False,\n",
       "  'originSpecies': '',\n",
       "  'volume': '0.050',\n",
       "  'engineeredStrain': '',\n",
       "  'knockedOutGenes': '',\n",
       "  'species': 'Rhodosporidium',\n",
       "  'oxygenLevel': 'sufficient',\n",
       "  'overexpressedGenes': '',\n",
       "  'time': '144',\n",
       "  'bioprocessNotes': ''},\n",
       " {'geneticNotes': '',\n",
       "  'heterologousGenes': '',\n",
       "  'integrationSites': '',\n",
       "  'nitrogenLevel': 'limited',\n",
       "  'media': '.75g/L yeast extract, 1.7 g/L YNB, 0.1g/L ammonium sulfate',\n",
       "  'substrateConc1': '40',\n",
       "  'substrateConc2': '',\n",
       "  'yield': '0.13',\n",
       "  'vessel': 'shake flask',\n",
       "  'temperature': '30',\n",
       "  'titer': '5.2',\n",
       "  'maximumRate': '0.0361',\n",
       "  'pH': '5.6',\n",
       "  'substrate1': 'galactose',\n",
       "  'geneIds': '',\n",
       "  'substrate2': '',\n",
       "  'promoters': '',\n",
       "  'parentStrain': 'IFO0880',\n",
       "  'strain': '',\n",
       "  'averageRate': '0.0361',\n",
       "  'product': 'galactitol',\n",
       "  'optimizedCodons': '',\n",
       "  'geneNames': '',\n",
       "  'originSpecies': '',\n",
       "  'directedEvolution': False,\n",
       "  'volume': '0.050',\n",
       "  'knockedOutGenes': '',\n",
       "  'engineeredStrain': '',\n",
       "  'oxygenLevel': 'sufficient',\n",
       "  'species': 'Rhodosporidium',\n",
       "  'overexpressedGenes': '',\n",
       "  'time': '144',\n",
       "  'bioprocessNotes': ''},\n",
       " {'geneticNotes': '',\n",
       "  'heterologousGenes': '',\n",
       "  'integrationSites': '',\n",
       "  'nitrogenLevel': 'limited',\n",
       "  'media': '.75g/L yeast extract, 1.7 g/L YNB, 0.1g/L ammonium sulfate',\n",
       "  'substrateConc1': '60',\n",
       "  'substrateConc2': '',\n",
       "  'vessel': 'shake flask',\n",
       "  'yield': '0.1233',\n",
       "  'titer': '7.4',\n",
       "  'maximumRate': '0.0385',\n",
       "  'temperature': '30',\n",
       "  'pH': '5.6',\n",
       "  'substrate1': 'galactose',\n",
       "  'substrate2': '',\n",
       "  'geneIds': '',\n",
       "  'parentStrain': 'IFO0880',\n",
       "  'promoters': '',\n",
       "  'strain': '',\n",
       "  'averageRate': '0.0385',\n",
       "  'product': 'galactitol',\n",
       "  'optimizedCodons': '',\n",
       "  'geneNames': '',\n",
       "  'directedEvolution': False,\n",
       "  'originSpecies': '',\n",
       "  'volume': '0.050',\n",
       "  'engineeredStrain': '',\n",
       "  'knockedOutGenes': '',\n",
       "  'species': 'Rhodosporidium',\n",
       "  'oxygenLevel': 'sufficient',\n",
       "  'overexpressedGenes': '',\n",
       "  'time': '192',\n",
       "  'bioprocessNotes': ''}]"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# get the json data from a file\n",
    "with open('../data/jagtap_2019.json', 'r') as f:\n",
    "    experimental_data = f.read()\n",
    "\n",
    "experimental_data = json.loads(experimental_data)\n",
    "\n",
    "# display the data inside the json file\n",
    "experimental_data"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Upload the JSON data through the API"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Error: Invalid JWT. Please include a valid JWT from https://impact-database.com/userinfo.\n"
     ]
    }
   ],
   "source": [
    "# this is the url of the api endpoint\n",
    "url = 'https://us-central1-impact-db.cloudfunctions.net/uploadExperimentalData'\n",
    "\n",
    "# data to be uploaded\n",
    "data = {\n",
    "    'species': 'rhodosporidium',\n",
    "    'slug': 'production-of-galactitol-from-galactose-by-the-oleaginous-yeast-rhodosporidium-toruloides-ifo0880',\n",
    "    'experimentalData': experimental_data, # data from json file\n",
    "}\n",
    "\n",
    "# replace YOUR_JWT_TOKEN with the token you get from your user info page: https://impact-database.com/userinfo\n",
    "your_jwt_token = \"YOUR_JWT_TOKEN\"\n",
    "\n",
    "# headers for the request\n",
    "headers = {\n",
    "    \"Content-Type\": \"application/json\",\n",
    "    \"Authorization\": f\"Bearer {your_jwt_token}\",\n",
    "}\n",
    "\n",
    "# send the post request to the api\n",
    "response = requests.post(url, data=json.dumps(data), headers=headers)\n",
    "\n",
    "print(response.text)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### 2. Upload experimental data from an excel file\n",
    "This example data is from a paper in ImpactDB [(Ye 2021)](https://impact-database.com/paper/rhodosporidium/optimising-nutrients-in-the-culture-medium-of-rhodosporidium-toruloides-enhances-lipids-production)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>species</th>\n",
       "      <th>strain</th>\n",
       "      <th>engineeredStrain</th>\n",
       "      <th>parentStrain</th>\n",
       "      <th>product</th>\n",
       "      <th>titer</th>\n",
       "      <th>averageRate</th>\n",
       "      <th>maximumRate</th>\n",
       "      <th>yield</th>\n",
       "      <th>volume</th>\n",
       "      <th>...</th>\n",
       "      <th>knockedOutGenes</th>\n",
       "      <th>overexpressedGenes</th>\n",
       "      <th>heterologousGenes</th>\n",
       "      <th>promoters</th>\n",
       "      <th>integrationSites</th>\n",
       "      <th>originSpecies</th>\n",
       "      <th>optimizedCodons</th>\n",
       "      <th>directedEvolution</th>\n",
       "      <th>geneticNotes</th>\n",
       "      <th>bioprocessNotes</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Rhodosporidium toruloides</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>ABC</td>\n",
       "      <td>lipid</td>\n",
       "      <td>7.769</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>100</td>\n",
       "      <td>...</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Rhodosporidium toruloides</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>ABC</td>\n",
       "      <td>lipid</td>\n",
       "      <td>6.769</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>100</td>\n",
       "      <td>...</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Rhodosporidium toruloides</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>ABC</td>\n",
       "      <td>lipid</td>\n",
       "      <td>4.638</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>100</td>\n",
       "      <td>...</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Rhodosporidium toruloides</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>ABC</td>\n",
       "      <td>lipid</td>\n",
       "      <td>2.436</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>100</td>\n",
       "      <td>...</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Rhodosporidium toruloides</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>ABC</td>\n",
       "      <td>lipid</td>\n",
       "      <td>1.761</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td>100</td>\n",
       "      <td>...</td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "      <td></td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows Ã— 33 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                     species strain engineeredStrain parentStrain product  \\\n",
       "0  Rhodosporidium toruloides                                  ABC   lipid   \n",
       "1  Rhodosporidium toruloides                                  ABC   lipid   \n",
       "2  Rhodosporidium toruloides                                  ABC   lipid   \n",
       "3  Rhodosporidium toruloides                                  ABC   lipid   \n",
       "4  Rhodosporidium toruloides                                  ABC   lipid   \n",
       "\n",
       "   titer averageRate maximumRate yield  volume  ... knockedOutGenes  \\\n",
       "0  7.769                                   100  ...                   \n",
       "1  6.769                                   100  ...                   \n",
       "2  4.638                                   100  ...                   \n",
       "3  2.436                                   100  ...                   \n",
       "4  1.761                                   100  ...                   \n",
       "\n",
       "  overexpressedGenes  heterologousGenes promoters integrationSites  \\\n",
       "0                                                                    \n",
       "1                                                                    \n",
       "2                                                                    \n",
       "3                                                                    \n",
       "4                                                                    \n",
       "\n",
       "  originSpecies  optimizedCodons directedEvolution geneticNotes  \\\n",
       "0                                                                 \n",
       "1                                                                 \n",
       "2                                                                 \n",
       "3                                                                 \n",
       "4                                                                 \n",
       "\n",
       "  bioprocessNotes  \n",
       "0                  \n",
       "1                  \n",
       "2                  \n",
       "3                  \n",
       "4                  \n",
       "\n",
       "[5 rows x 33 columns]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'list'> [{'species': 'Rhodosporidium toruloides', 'strain': '', 'engineeredStrain': '', 'parentStrain': 'ABC', 'product': 'lipid', 'titer': 7.769, 'averageRate': '', 'maximumRate': '', 'yield': '', 'volume': 100, 'vessel': 'shake flask', 'substrate1': 'sucrose', 'substrateConc1': 40, 'substrate2': '', 'substrateConc2': '', 'media': 'defined', 'time': 24, 'oxygenLevel': 'sufficient', 'nitrogenLevel': 'sufficient', 'pH': '', 'temperature': 28, 'geneIds': '', 'geneNames': '', 'knockedOutGenes': '', 'overexpressedGenes': '', 'heterologousGenes': '', 'promoters': '', 'integrationSites': '', 'originSpecies': '', 'optimizedCodons': '', 'directedEvolution': '', 'geneticNotes': '', 'bioprocessNotes': ''}, {'species': 'Rhodosporidium toruloides', 'strain': '', 'engineeredStrain': '', 'parentStrain': 'ABC', 'product': 'lipid', 'titer': 6.769, 'averageRate': '', 'maximumRate': '', 'yield': '', 'volume': 100, 'vessel': 'shake flask', 'substrate1': 'sucrose', 'substrateConc1': 40, 'substrate2': '', 'substrateConc2': '', 'media': 'defined', 'time': 24, 'oxygenLevel': 'sufficient', 'nitrogenLevel': 'CIN = 40: 1', 'pH': '', 'temperature': 28, 'geneIds': '', 'geneNames': '', 'knockedOutGenes': '', 'overexpressedGenes': '', 'heterologousGenes': '', 'promoters': '', 'integrationSites': '', 'originSpecies': '', 'optimizedCodons': '', 'directedEvolution': '', 'geneticNotes': '', 'bioprocessNotes': ''}, {'species': 'Rhodosporidium toruloides', 'strain': '', 'engineeredStrain': '', 'parentStrain': 'ABC', 'product': 'lipid', 'titer': 4.638, 'averageRate': '', 'maximumRate': '', 'yield': '', 'volume': 100, 'vessel': 'shake flask', 'substrate1': 'sucrose', 'substrateConc1': 40, 'substrate2': '', 'substrateConc2': '', 'media': 'defined', 'time': 24, 'oxygenLevel': 'sufficient', 'nitrogenLevel': 'C/N=80:1', 'pH': '', 'temperature': 28, 'geneIds': '', 'geneNames': '', 'knockedOutGenes': '', 'overexpressedGenes': '', 'heterologousGenes': '', 'promoters': '', 'integrationSites': '', 'originSpecies': '', 'optimizedCodons': '', 'directedEvolution': '', 'geneticNotes': '', 'bioprocessNotes': ''}, {'species': 'Rhodosporidium toruloides', 'strain': '', 'engineeredStrain': '', 'parentStrain': 'ABC', 'product': 'lipid', 'titer': 2.436, 'averageRate': '', 'maximumRate': '', 'yield': '', 'volume': 100, 'vessel': 'shake flask', 'substrate1': 'sucrose', 'substrateConc1': 40, 'substrate2': '', 'substrateConc2': '', 'media': 'defined', 'time': 24, 'oxygenLevel': 'sufficient', 'nitrogenLevel': 'C/N=160:1', 'pH': '', 'temperature': 28, 'geneIds': '', 'geneNames': '', 'knockedOutGenes': '', 'overexpressedGenes': '', 'heterologousGenes': '', 'promoters': '', 'integrationSites': '', 'originSpecies': '', 'optimizedCodons': '', 'directedEvolution': '', 'geneticNotes': '', 'bioprocessNotes': ''}, {'species': 'Rhodosporidium toruloides', 'strain': '', 'engineeredStrain': '', 'parentStrain': 'ABC', 'product': 'lipid', 'titer': 1.761, 'averageRate': '', 'maximumRate': '', 'yield': '', 'volume': 100, 'vessel': 'shake flask', 'substrate1': 'sucrose', 'substrateConc1': 40, 'substrate2': '', 'substrateConc2': '', 'media': 'defined', 'time': 24, 'oxygenLevel': 'sufficient', 'nitrogenLevel': 'C/N =200:1', 'pH': '', 'temperature': 28, 'geneIds': '', 'geneNames': '', 'knockedOutGenes': '', 'overexpressedGenes': '', 'heterologousGenes': '', 'promoters': '', 'integrationSites': '', 'originSpecies': '', 'optimizedCodons': '', 'directedEvolution': '', 'geneticNotes': '', 'bioprocessNotes': ''}, {'species': 'Rhodosporidium toruloides', 'strain': '', 'engineeredStrain': '', 'parentStrain': 'ABC', 'product': 'lipid', 'titer': 0.924, 'averageRate': '', 'maximumRate': '', 'yield': '', 'volume': 100, 'vessel': 'shake flask', 'substrate1': 'sucrose', 'substrateConc1': 40, 'substrate2': '', 'substrateConc2': '', 'media': 'defined', 'time': 24, 'oxygenLevel': 'sufficient', 'nitrogenLevel': 'C/N = infinity', 'pH': '', 'temperature': 28, 'geneIds': '', 'geneNames': '', 'knockedOutGenes': '', 'overexpressedGenes': '', 'heterologousGenes': '', 'promoters': '', 'integrationSites': '', 'originSpecies': '', 'optimizedCodons': '', 'directedEvolution': '', 'geneticNotes': '', 'bioprocessNotes': ''}, {'species': 'Rhodosporidium toruloides', 'strain': '', 'engineeredStrain': '', 'parentStrain': 'ABC', 'product': 'lipid', 'titer': 4.88, 'averageRate': '', 'maximumRate': '', 'yield': '', 'volume': 100, 'vessel': 'shake flask', 'substrate1': 'sucrose', 'substrateConc1': 40, 'substrate2': '', 'substrateConc2': '', 'media': 'defined', 'time': 24, 'oxygenLevel': 'sufficient', 'nitrogenLevel': 'C/N=20.1', 'pH': '', 'temperature': 28, 'geneIds': '', 'geneNames': '', 'knockedOutGenes': '', 'overexpressedGenes': '', 'heterologousGenes': '', 'promoters': '', 'integrationSites': '', 'originSpecies': '', 'optimizedCodons': '', 'directedEvolution': '', 'geneticNotes': '', 'bioprocessNotes': ''}, {'species': 'Rhodosporidium toruloides', 'strain': '', 'engineeredStrain': '', 'parentStrain': 'ABC', 'product': 'lipid', 'titer': 4.96, 'averageRate': '', 'maximumRate': '', 'yield': '', 'volume': 100, 'vessel': 'shake flask', 'substrate1': 'sucrose', 'substrateConc1': 40, 'substrate2': '', 'substrateConc2': '', 'media': 'defined', 'time': 24, 'oxygenLevel': 'sufficient', 'nitrogenLevel': 'CIN = 40: 1', 'pH': '', 'temperature': 28, 'geneIds': '', 'geneNames': '', 'knockedOutGenes': '', 'overexpressedGenes': '', 'heterologousGenes': '', 'promoters': '', 'integrationSites': '', 'originSpecies': '', 'optimizedCodons': '', 'directedEvolution': '', 'geneticNotes': '', 'bioprocessNotes': ''}, {'species': 'Rhodosporidium toruloides', 'strain': '', 'engineeredStrain': '', 'parentStrain': 'ABC', 'product': 'lipid', 'titer': 6.35, 'averageRate': '', 'maximumRate': '', 'yield': '', 'volume': 100, 'vessel': 'shake flask', 'substrate1': 'sucrose', 'substrateConc1': 40, 'substrate2': '', 'substrateConc2': '', 'media': 'defined', 'time': 24, 'oxygenLevel': 'sufficient', 'nitrogenLevel': 'C/N=80:1', 'pH': '', 'temperature': 28, 'geneIds': '', 'geneNames': '', 'knockedOutGenes': '', 'overexpressedGenes': '', 'heterologousGenes': '', 'promoters': '', 'integrationSites': '', 'originSpecies': '', 'optimizedCodons': '', 'directedEvolution': '', 'geneticNotes': '', 'bioprocessNotes': ''}, {'species': 'Rhodosporidium toruloides', 'strain': '', 'engineeredStrain': '', 'parentStrain': 'ABC', 'product': 'lipid', 'titer': 5.82, 'averageRate': '', 'maximumRate': '', 'yield': '', 'volume': 100, 'vessel': 'shake flask', 'substrate1': 'sucrose', 'substrateConc1': 40, 'substrate2': '', 'substrateConc2': '', 'media': 'defined', 'time': 24, 'oxygenLevel': 'sufficient', 'nitrogenLevel': 'C/N=160:1', 'pH': '', 'temperature': 28, 'geneIds': '', 'geneNames': '', 'knockedOutGenes': '', 'overexpressedGenes': '', 'heterologousGenes': '', 'promoters': '', 'integrationSites': '', 'originSpecies': '', 'optimizedCodons': '', 'directedEvolution': '', 'geneticNotes': '', 'bioprocessNotes': ''}, {'species': 'Rhodosporidium toruloides', 'strain': '', 'engineeredStrain': '', 'parentStrain': 'ABC', 'product': 'lipid', 'titer': 5.32, 'averageRate': '', 'maximumRate': '', 'yield': '', 'volume': 100, 'vessel': 'shake flask', 'substrate1': 'sucrose', 'substrateConc1': 40, 'substrate2': '', 'substrateConc2': '', 'media': 'defined', 'time': 24, 'oxygenLevel': 'sufficient', 'nitrogenLevel': 'C/N =200:1', 'pH': '', 'temperature': 28, 'geneIds': '', 'geneNames': '', 'knockedOutGenes': '', 'overexpressedGenes': '', 'heterologousGenes': '', 'promoters': '', 'integrationSites': '', 'originSpecies': '', 'optimizedCodons': '', 'directedEvolution': '', 'geneticNotes': '', 'bioprocessNotes': ''}, {'species': 'Rhodosporidium toruloides', 'strain': '', 'engineeredStrain': '', 'parentStrain': 'ABC', 'product': 'lipid', 'titer': 1.32, 'averageRate': '', 'maximumRate': '', 'yield': '', 'volume': 100, 'vessel': 'shake flask', 'substrate1': 'sucrose', 'substrateConc1': 40, 'substrate2': '', 'substrateConc2': '', 'media': 'defined', 'time': 24, 'oxygenLevel': 'sufficient', 'nitrogenLevel': 'C/N = infinity', 'pH': '', 'temperature': 28, 'geneIds': '', 'geneNames': '', 'knockedOutGenes': '', 'overexpressedGenes': '', 'heterologousGenes': '', 'promoters': '', 'integrationSites': '', 'originSpecies': '', 'optimizedCodons': '', 'directedEvolution': '', 'geneticNotes': '', 'bioprocessNotes': ''}]\n"
     ]
    }
   ],
   "source": [
    "# load excel data into a dataframe\n",
    "excel_df = pd.read_excel('../data/ye_2021.xlsx')\n",
    "\n",
    "# replace NaN with empty strings\n",
    "excel_df = excel_df.fillna('')\n",
    "\n",
    "# convert dataframe to json string\n",
    "excel_df_as_json_str = excel_df.to_json(orient='records')\n",
    "\n",
    "# convert json string to json object\n",
    "excel_df_as_json_obj = json.loads(excel_df_as_json_str)\n",
    "\n",
    "display(excel_df.head())\n",
    "print(type(excel_df_as_json_obj), excel_df_as_json_obj)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Upload the excel data through the API"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Error: Invalid JWT. Please include a valid JWT from https://impact-database.com/userinfo.\n"
     ]
    }
   ],
   "source": [
    "# this is the url of the api endpoint\n",
    "url = 'https://us-central1-impact-db.cloudfunctions.net/uploadExperimentalData'\n",
    "\n",
    "# data to be uploaded\n",
    "data = {\n",
    "    'species': 'rhodosporidium',\n",
    "    'slug': 'optimising-nutrients-in-the-culture-medium-of-rhodosporidium-toruloides-enhances-lipids-production',\n",
    "    'experimentalData': excel_df_as_json_obj, # data from excel file\n",
    "}\n",
    "\n",
    "# replace YOUR_JWT_TOKEN with the token you get from your user info page: https://impact-database.com/userinfo\n",
    "your_jwt_token = \"YOUR_JWT_TOKEN\"\n",
    "\n",
    "# headers for the request\n",
    "headers = {\n",
    "    \"Content-Type\": \"application/json\",\n",
    "    \"Authorization\": f\"Bearer {your_jwt_token}\",\n",
    "}\n",
    "\n",
    "# send the post request to the api\n",
    "response = requests.post(url, data=json.dumps(data), headers=headers)\n",
    "\n",
    "print(response.text)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### 3. Upload manually defined data\n",
    "This example data is from a paper in ImpactDB [(Zhuang 2019)](https://impact-database.com/paper/rhodosporidium/monoterpene-production-by-the-carotenogenic-yeast-rhodosporidium-toruloides)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [],
   "source": [
    "manually_defined_experimental_data = [\n",
    "  {\n",
    "    \"geneticNotes\": \"\",\n",
    "    \"heterologousGenes\": \"\",\n",
    "    \"integrationSites\": \"\",\n",
    "    # \"nitrogenLevel\": \"\",\n",
    "    \"nitrogenLevel\": \"sufficient\",\n",
    "    \"media\": \"rich\",\n",
    "    \"substrateConc1\": \"0\",\n",
    "    \"substrateConc2\": \"\",\n",
    "    \"vessel\": \"batch reactor\",\n",
    "    \"yield\": \"\",\n",
    "    \"titer\": \"0.02764\",\n",
    "    \"pH\": \"7.4\",\n",
    "    \"maximumRate\": \"\",\n",
    "    \"temperature\": \"30\",\n",
    "    \"substrate1\": \"Waste hydrolysate\",\n",
    "    \"substrate2\": \"\",\n",
    "    \"geneIds\": \"\",\n",
    "    \"promoters\": \"\",\n",
    "    # \"parentStrain\": \"\",\n",
    "    \"parentStrain\": \"temp name\",\n",
    "    \"strain\": \"Rhodosporidium toruloides\",\n",
    "    \"averageRate\": \"\",\n",
    "    \"product\": \"1,8-cineole\",\n",
    "    \"optimizedCodons\": \"\",\n",
    "    \"geneNames\": \"\",\n",
    "    \"directedEvolution\": False,\n",
    "    \"originSpecies\": \"\",\n",
    "    \"volume\": \"2\",\n",
    "    \"engineeredStrain\": \"\",\n",
    "    \"knockedOutGenes\": \"\",\n",
    "    \"oxygenLevel\": \"sufficient\",\n",
    "    \"species\": \"Rhodosporidium\",\n",
    "    \"overexpressedGenes\": \"\",\n",
    "    \"time\": \"168\",\n",
    "    \"bioprocessNotes\": \"\"\n",
    "  }\n",
    "]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Upload the manually written data through the API"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Error: Invalid JWT. Please include a valid JWT from https://impact-database.com/userinfo.\n"
     ]
    }
   ],
   "source": [
    "# this is the url of the api endpoint\n",
    "url = 'https://us-central1-impact-db.cloudfunctions.net/uploadExperimentalData'\n",
    "\n",
    "# data to be uploaded\n",
    "data = {\n",
    "    'species': 'rhodosporidium',\n",
    "    'slug': 'monoterpene-production-by-the-carotenogenic-yeast-rhodosporidium-toruloides',\n",
    "    'experimentalData': manually_defined_experimental_data, # data from python object\n",
    "}\n",
    "\n",
    "# replace YOUR_JWT_TOKEN with the token you get from your user info page: https://impact-database.com/userinfo\n",
    "your_jwt_token = \"YOUR_JWT_TOKEN\"\n",
    "\n",
    "# headers for the request\n",
    "headers = {\n",
    "    \"Content-Type\": \"application/json\",\n",
    "    \"Authorization\": f\"Bearer {your_jwt_token}\",\n",
    "}\n",
    "\n",
    "# send the post request to the api\n",
    "response = requests.post(url, data=json.dumps(data), headers=headers)\n",
    "\n",
    "print(response.text)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "venv",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.2"
  },
  "orig_nbformat": 4
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
